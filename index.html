<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>神经网络小镇</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/ui.css">
    <link rel="stylesheet" href="css/tutorial.css">
</head>
<body>
    <div id="login-screen" class="login-screen">
        <div class="login-box">
            <h2>欢迎来到神经网络小镇</h2>
            
            <div class="game-intro">
                <div class="intro-header">
                    <span class="intro-icon">🧠</span>
                    <h3>探索神经网络的奇妙世界</h3>
                    <p class="intro-subtitle">一个互动式的人工智能学习平台</p>
                </div>

                <div class="intro-description">
                    <p>在这个独特的虚拟小镇中，你将与8个富有个性的AI智能体互动，见证它们如何协同工作，共同构建一个生动的神经网络系统。每个AI都有其独特的角色和个性：</p>
                </div>

                <div class="agents-intro">
                    <div class="agent-intro-item">
                        <div class="agent-icon-wrapper">
                            <span class="agent-icon">🔍</span>
                        </div>
                        <div class="agent-info">
                            <span class="agent-name">输入神经元</span>
                            <span class="agent-desc">感知外界信息的敏锐观察者，是神经网络的"眼睛"</span>
                        </div>
                    </div>
                    <div class="agent-intro-item">
                        <div class="agent-icon-wrapper">
                            <span class="agent-icon">⚡</span>
                        </div>
                        <div class="agent-info">
                            <span class="agent-name">处理单元</span>
                            <span class="agent-desc">高效的数据分析专家，将原始信息转化为有用的知识</span>
                        </div>
                    </div>
                    <div class="agent-intro-item">
                        <div class="agent-icon-wrapper">
                            <span class="agent-icon">📚</span>
                        </div>
                        <div class="agent-info">
                            <span class="agent-name">记忆中枢</span>
                            <span class="agent-desc">知识的守护者，负责存储和管理网络的经验</span>
                        </div>
                    </div>
                    <div class="agent-intro-item">
                        <div class="agent-icon-wrapper">
                            <span class="agent-icon">🎯</span>
                        </div>
                        <div class="agent-info">
                            <span class="agent-name">决策核心</span>
                            <span class="agent-desc">理性的决策者，权衡利弊做出最优选择</span>
                        </div>
                    </div>
                    <div class="agent-intro-item">
                        <div class="agent-icon-wrapper">
                            <span class="agent-icon">🎚️</span>
                        </div>
                        <div class="agent-info">
                            <span class="agent-name">输出控制器</span>
                            <span class="agent-desc">精确的调节师，确保输出结果的稳定性</span>
                        </div>
                    </div>
                    <div class="agent-intro-item">
                        <div class="agent-icon-wrapper">
                            <span class="agent-icon">🚀</span>
                        </div>
                        <div class="agent-info">
                            <span class="agent-name">学习优化器</span>
                            <span class="agent-desc">进步的推动者，不断提升网络的性能</span>
                        </div>
                    </div>
                    <div class="agent-intro-item">
                        <div class="agent-icon-wrapper">
                            <span class="agent-icon">⚖️</span>
                        </div>
                        <div class="agent-info">
                            <span class="agent-name">权重调节器</span>
                            <span class="agent-desc">平衡的艺术家，调整网络连接的重要性</span>
                        </div>
                    </div>
                    <div class="agent-intro-item">
                        <div class="agent-icon-wrapper">
                            <span class="agent-icon">✨</span>
                        </div>
                        <div class="agent-info">
                            <span class="agent-name">激活函数</span>
                            <span class="agent-desc">信号的转换大师，赋予网络非线性能力</span>
                        </div>
                    </div>
                </div>

                <div class="features-section">
                    <h3>探索特色</h3>
                    <div class="features-grid">
                        <div class="feature-item">
                            <span class="feature-icon">🤖</span>
                            <h4>智能对话</h4>
                            <p>与每个AI进行独特的对话，了解它们的想法和个性</p>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">📊</span>
                            <h4>数据可视化</h4>
                            <p>直观地观察数据在神经网络中的流动和处理过程</p>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">🔄</span>
                            <h4>实时反馈</h4>
                            <p>实时监控网络的运行状态和性能变化</p>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">🤝</span>
                            <h4>互动协作</h4>
                            <p>见证AI之间的协作与成长，建立关系网络</p>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">🎮</span>
                            <h4>参数调节</h4>
                            <p>通过控制面板调整系统参数，优化网络性能</p>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">📈</span>
                            <h4>学习成长</h4>
                            <p>观察AI如何通过经验积累不断进步和发展</p>
                        </div>
                    </div>
                </div>

                <div class="purpose-section">
                    <h3>游戏意义</h3>
                    <div class="purpose-content">
                        <p>这个交互式平台旨在帮助你：</p>
                        <ul>
                            <li>深入理解神经网络的工作原理</li>
                            <li>体验AI系统中各组件的协同效应</li>
                            <li>感受人工智能的个性化和拟人化特征</li>
                            <li>探索AI学习和决策的过程</li>
                            <li>激发对人工智能领域的兴趣和思考</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="login-section">
                <p class="api-notice">🔑 请输入您的 Deepseek API Key 开始探索之旅</p>
                <div class="input-group">
                    <input type="password" id="api-key-input" placeholder="输入 API Key">
                    <button id="login-btn">进入游戏</button>
                </div>
                <div id="login-message" class="login-message"></div>
            </div>
        </div>
    </div>

    <div id="game-container" class="game-container hidden">
        <div id="town-container">
            <div id="background-layer"></div>
            <div id="agents-layer"></div>
            <div id="ui-layer"></div>
            <div id="control-panel" class="control-panel">
                <div class="control-header">
                    <h2>控制面板</h2>
                    <button class="toggle-btn">≡</button>
                </div>
                <div class="control-content">
                    <div class="control-section">
                        <h3>系统状态</h3>
                        <div class="status-display">
                            <div class="status-item">
                                <label>运行状态:</label>
                                <span id="system-status">运行中</span>
                            </div>
                            <div class="status-item">
                                <label>处理次数:</label>
                                <span id="process-count">0</span>
                            </div>
                        </div>
                    </div>
                    <div class="control-section">
                        <h3>操作控制</h3>
                        <div class="control-buttons">
                            <button id="start-btn" class="control-btn">开始</button>
                            <button id="pause-btn" class="control-btn">暂停</button>
                            <button id="reset-btn" class="control-btn">重置</button>
                        </div>
                        <div class="control-sliders">
                            <div class="slider-group">
                                <label>处理速度</label>
                                <input type="range" id="speed-control" min="1" max="10" value="5">
                            </div>
                            <div class="slider-group">
                                <label>学习率</label>
                                <input type="range" id="learning-rate" min="1" max="100" value="50">
                            </div>
                        </div>
                    </div>
                    <div class="control-section">
                        <h3>数据监控</h3>
                        <div class="monitor-display">
                            <canvas id="performance-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="js/main.js"></script>
    <script>
        window.sendMessage = async function(agentId) {
            try {
                const inputElement = document.getElementById(`chat-input-${agentId}`);
                const message = inputElement.value.trim();
                if (!message) return;

                console.log('发送消息给 Agent:', agentId, message);
                
                const agent = window.townManager.agents.find(a => a.id === agentId);
                if (!agent) {
                    console.error('未找到指定的 Agent:', agentId);
                    return;
                }

                // 禁用输入框和按钮，显示加载状态
                inputElement.disabled = true;
                const button = inputElement.nextElementSibling;
                button.disabled = true;
                button.textContent = '发送中...';

                const response = await agent.chat(message);
                console.log('收到回复:', response);

                // 清空输入框并刷新对话界面
                inputElement.value = '';
                if (window.townManager.infoPanel.currentAgent === agent) {
                    window.townManager.infoPanel.show(agent);
                }
            } catch (error) {
                console.error('发送消息失败:', error);
                window.townManager.showNotification('发送消息失败，请重试', 'error');
            } finally {
                // 恢复输入框和按钮状态
                const inputElement = document.getElementById(`chat-input-${agentId}`);
                const button = inputElement.nextElementSibling;
                inputElement.disabled = false;
                button.disabled = false;
                button.textContent = '发送';
            }
        }
    </script>
</body>
</html>
